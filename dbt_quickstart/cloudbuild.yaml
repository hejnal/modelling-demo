steps:
- name: gcr.io/cloud-builders/docker
  id: Build Dbt Image
  env: 
    - 'DOCKER_BUILDKIT=1'
  args: [
      'build',
      '-t', 'europe-docker.pkg.dev/$PROJECT_ID/dbt-modelling-demo',
      '--cache-from', 'europe-docker.pkg.dev/$PROJECT_ID/dbt-modelling-demo/dbt-on-cloud-run-demo:latest',
      './dbt_quickstart/'
    ]

- name: gcr.io/cloud-builders/docker
  id: Push Dbt Image to the Repo
  args: [
      'push',
      'europe-docker.pkg.dev/$PROJECT_ID/dbt-modelling-demo/dbt-on-cloud-run-demo:latest'
    ]

options:
  logging: CLOUD_LOGGING_ONLY